

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cell nesting &mdash; PyPipeline  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Scale-up basics" href="p05_scale_up_basics.html" />
    <link rel="prev" title="Pipeline basics" href="p03_pipeline_basics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PyPipeline
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../d01_overview/overview.html">PyPipeline</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="p01_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="p02_minimal_example.html">Minimal example</a></li>
<li class="toctree-l1"><a class="reference internal" href="p03_pipeline_basics.html">Pipeline basics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cell nesting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#intro">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cell-class-hierarchy">Cell class hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="p05_scale_up_basics.html">Scale-up basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="p06_cell_parameters.html">Cell parameters</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../d03_advanced/p01_architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../d03_advanced/p02_topology_determination.html">Topology determination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../d03_advanced/p03_pull_based_execution.html">Pull-based execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../d03_advanced/p04_validation.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../d03_advanced/p05_scalable_cells_revisited.html">Scalable cells revisited</a></li>
<li class="toctree-l1"><a class="reference internal" href="../d03_advanced/p06_performance_tests.html">Performance tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../d04_deep_learning/p01_neural_network_training.html">Neural network training</a></li>
</ul>
<p class="caption"><span class="caption-text">PyPipeline Serve</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../d05_pypipeline_serve/p01_http_api_generation_basics.html">HTTP API generation basics</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyPipeline</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Cell nesting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/d02_getting_started/p04_cell_nesting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cell-nesting">
<h1>Cell nesting<a class="headerlink" href="#cell-nesting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>The basic pipeline example shows the first usecase of nesting cells inside a pipeline.</p>
<p>Visually, we represent cell nesting by drawing them inside the parent object (the pipeline).</p>
<div class="figure align-default" id="id1">
<img alt="../_images/pypipeline-docs-getting-started-pipeline_new.png" src="../_images/pypipeline-docs-getting-started-pipeline_new.png" />
<p class="caption"><span class="caption-text">The basic pipeline example, built in previous section. Three cells are nested inside one pipeline.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>In code, cells are nested when they get a <code class="docutils literal notranslate"><span class="pre">parent_cell</span></code> argument during initialization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_cell</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ACompositeCell</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="c1"># Every cell is created with a parent_cell (self in this case) and a name</span>
        <span class="c1"># Note that we leave out the argument names after the first cell.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">SourceCell</span><span class="p">(</span><span class="n">parent_cell</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">MultiplierCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;multiplier&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span> <span class="o">=</span> <span class="n">PrinterCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;printer&quot;</span><span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Based on the typing info, you might have come to the conclusion that a <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> object must be an instance
of an <code class="docutils literal notranslate"><span class="pre">ACompositeCell</span></code>. This is indeed the case! Let’s formalize this.</p>
</div>
<div class="section" id="cell-class-hierarchy">
<h2>Cell class hierarchy<a class="headerlink" href="#cell-class-hierarchy" title="Permalink to this headline">¶</a></h2>
<p>PyPipeline has three types of main building blocks to assemble complex applications: cells, cell IO
(inputs and outputs), and connections. We’ve already seen three types of cells as well: <code class="docutils literal notranslate"><span class="pre">ASingleCell</span></code>,
<code class="docutils literal notranslate"><span class="pre">ACompositeCell</span></code> and a <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>. The following UML class diagram explains the relations between these
different types of cells.</p>
<div class="figure align-default" id="id2">
<img alt="../_images/pypipeline-docs-getting-started-nesting-uml-pipeline.png" src="../_images/pypipeline-docs-getting-started-nesting-uml-pipeline.png" />
<p class="caption"><span class="caption-text">A (simplified) UML class diagram of the relation between cells and pipelines.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>All cells inherit from the <code class="docutils literal notranslate"><span class="pre">ACell</span></code> class. It’s leading <code class="docutils literal notranslate"><span class="pre">A</span></code> indicates it is an <em>abstract</em> class, meaning it
should only be inherited from, never instantiated directly. This class gathers the functionality that is common
to all cells in PyPipeline. For example, it keeps track of the <code class="docutils literal notranslate"><span class="pre">parent_cell</span></code> property of your cells, as well
as the cell’s inputs and outputs, and much more.</p>
<p>There are two subtypes of <code class="docutils literal notranslate"><span class="pre">ACell</span></code>: <code class="docutils literal notranslate"><span class="pre">ASingleCell</span></code> and <code class="docutils literal notranslate"><span class="pre">ACompositeCell</span></code>. The former one is the easiest,
and represents all cells that do some single operation. The latter one is a type of cell that can aggregate other cells.
These other cells are said to be “nested” inside the composite cell. The composite cell composes the operations
of all its internal cells into one large operation. This design pattern is called the
<a class="reference external" href="https://en.wikipedia.org/wiki/Composite_pattern">Composite Pattern</a>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> is the first type of composite cell that we’ve seen so far. We’ll come in contact with more
composite cell types when we’ll start scaling up parts of our pipeline.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>A cool aspect of the composite pattern, is that you can nest cells endlessly deep! Indeed, the internal cells
of a composite cell don’t necessarily have to be single cells. They can be composite cells as well.</p>
<p>Also, composite cells (and therefore pipelines as well) inherit from the <code class="docutils literal notranslate"><span class="pre">ACell</span></code> class, so they inherit the
functionality to have inputs and outputs too. Composite cells allow a new type of inputs and outputs: the
<code class="docutils literal notranslate"><span class="pre">InputPort</span></code> and <code class="docutils literal notranslate"><span class="pre">OutputPort</span></code>. They both allow incoming and outgoing connections, functioning as
data ports to the internal cells of the composite cell.</p>
<p>This allows us to build pipelines like this:</p>
<div class="figure align-default" id="id3">
<img alt="../_images/pypipeline-docs-getting-started-pipeline-nesting.png" src="../_images/pypipeline-docs-getting-started-pipeline-nesting.png" />
<p class="caption"><span class="caption-text">A nested pipeline, with inputs and outputs. This can be useful when you want to reuse your nested pipeline
in other pipelines with different sources and sinks.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The code for this example is given here. The <code class="docutils literal notranslate"><span class="pre">SourceCell</span></code>, <code class="docutils literal notranslate"><span class="pre">MultiplierCell</span></code> and <code class="docutils literal notranslate"><span class="pre">PrinterCell</span></code> are the same
as in the basic pipeline example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">pypipeline.cell</span> <span class="kn">import</span> <span class="n">ASingleCell</span><span class="p">,</span> <span class="n">ACompositeCell</span><span class="p">,</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pypipeline.cellio</span> <span class="kn">import</span> <span class="n">Output</span><span class="p">,</span> <span class="n">OutputPort</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">InputPort</span>
<span class="kn">from</span> <span class="nn">pypipeline.connection</span> <span class="kn">import</span> <span class="n">Connection</span>


<span class="k">class</span> <span class="nc">SourceCell</span><span class="p">(</span><span class="n">ASingleCell</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MultiplierCell</span><span class="p">(</span><span class="n">ASingleCell</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">PrinterCell</span><span class="p">(</span><span class="n">ASingleCell</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyNestedPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_cell</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ACompositeCell</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyNestedPipeline</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent_cell</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_a</span><span class="p">:</span> <span class="n">InputPort</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">InputPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;input_a&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_b</span><span class="p">:</span> <span class="n">InputPort</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">InputPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;input_b&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span> <span class="n">OutputPort</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">OutputPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;nested_pipeline_output&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier_1</span> <span class="o">=</span> <span class="n">MultiplierCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;multiplier_1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier_2</span> <span class="o">=</span> <span class="n">MultiplierCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;multiplier_2&quot;</span><span class="p">)</span>

        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier_1</span><span class="o">.</span><span class="n">input_a</span><span class="p">)</span>
        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier_1</span><span class="o">.</span><span class="n">input_b</span><span class="p">)</span>
        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier_2</span><span class="o">.</span><span class="n">input_b</span><span class="p">)</span>
        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplier_1</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier_2</span><span class="o">.</span><span class="n">input_a</span><span class="p">)</span>
        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplier_2</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_cell</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ACompositeCell</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyPipeline</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent_cell</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">SourceCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nested_pipeline</span> <span class="o">=</span> <span class="n">MyNestedPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;my_nested_pipeline&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printer</span> <span class="o">=</span> <span class="n">PrinterCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;printer&quot;</span><span class="p">)</span>

        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">output_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_pipeline</span><span class="o">.</span><span class="n">input_a</span><span class="p">)</span>
        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">output_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested_pipeline</span><span class="o">.</span><span class="n">input_b</span><span class="p">)</span>
        <span class="n">Connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested_pipeline</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>


<span class="n">pipeline</span> <span class="o">=</span> <span class="n">MyPipeline</span><span class="p">(</span><span class="n">parent_cell</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_pipeline&quot;</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">deploy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">pull</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0
1
2
3
4
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="p05_scale_up_basics.html" class="btn btn-neutral float-right" title="Scale-up basics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="p03_pipeline_basics.html" class="btn btn-neutral float-left" title="Pipeline basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Johannes Verherstraeten.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>